pool:
  vmImage: "windows-latest"

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: ">=20.0.0"
    displayName: "Install Node.js>20"

  - script: |
      npm ci
    displayName: "Install dependencies"

  - script: |
      npx playwright install --with-deps
    displayName: "Install Playwright"

  - script: |
      npm install -g allure-commandline  
    displayName: "Install Allure"

  - script: npx playwright test
    displayName: "Run Playwright tests"
    env:
      ADO_TOKEN: $(ADO_TOKEN)

  # - script: |
  #     allure generate --single-file allure-results
  #   displayName: 'Generate allure report'
  #   condition: always()

  - task: PublishTestResults@2
    displayName: 'Publish Junit results'
    condition: always()
    inputs:
      testResultsFiles: "results.xml"
      testRunTitle: "Playwright Junit Test Results"

  - task: PublishBuildArtifacts@1
    displayName: 'Publish HTML Playwright report'
    condition: always()
    inputs:
      PathtoPublish: "playwright-report"
      ArtifactName: "playwright-report"
      publishLocation: "Container"

  # - task: PublishBuildArtifacts@1
  #   displayName: 'Publish Allure report'
  #   condition: always()
  #   inputs:
  #     PathtoPublish: "allure-results"
  #     ArtifactName: "allure-results"
  #     publishLocation: "Container"

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Ortoni report'
    condition: always()
    inputs:
      PathtoPublish: "report"
      ArtifactName: "ortoni-report"
      publishLocation: "Container"

  # - task: PublishAllureReport@1
  #   displayName: 'Publish report to the allure report extension'
  #   condition: always()
  #   inputs:
  #     allureVersion: 2.27.0
  #     testResultsDir: allure-results
